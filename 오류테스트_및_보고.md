# 전체 오류 테스트 및 DB/기능 보고

## 1. 적용 완료 사항 요약

### 1) 설문 저장·불러오기
- **저장 제목**: 신규 저장 시 제목 앞에 `[전체설문]` 또는 `[간편설문랜덤]` + 로그인 아이디 + 저장일시 자동 표시.
- **불러오기**: 목록 버튼 클릭 시 전체 목록 표시, 영역 `max-h-[65vh]`로 스크롤 가능.
- **검색**: `[전체설문]`, `[간편설문랜덤]` 등 제목(머리말)으로 검색 가능 (API `?q=` 연동).

### 2) 관리자 메뉴·회원관리
- **로그인 화면** → "관리자 화면" 클릭 시 관리자 페이지 진입.
- **관리자 기본 메뉴**: "로그인 계정", "회원 관리" 탭 구성.
- **회원 관리**: 가입 회원 목록 조회, 삭제 가능. (`GET /api/admin/users`, `POST /api/admin/users/delete`)

### 3) DBMS (MySQL, dothome)
- **연결 정보**: localhost, DB `leejee5`, 사용자 `leejee5`, 비밀번호 `sunkim5do#`.
- **테이블**: `users`, `survey_saves`, `chat_saves`, `board`, `eeg_saves` (create_tables_mysql.sql).
- **SQL 문법**: 괄호 균형 및 스키마 확인 완료. MySQL 5.7/8.0 호환.

### 4) 정상 저장 확인 기능
- **설문 저장**: 응답에 `saved_ok: true` 포함, 화면에 "정상 저장되었습니다." 표시.
- **대화 저장**: `saved_ok` 시 "정상 저장되었습니다." 표시.
- **게시판·자료실**: 저장 성공 시 "정상 저장되었습니다." 표시.
- **뇌파 저장**: `saved_ok` 시 "정상 저장되었습니다." 표시.

### 5) Step3 뇌파 원천데이터
- **불러오기**: 기존대로 파일 선택 후 "불러오기"로 로드.
- **저장**: 불러오기 또는 지표 입력 후 "저장" 버튼으로 DB 저장 (테이블 `eeg_saves`).
- **목록보기**: "목록보기" 버튼 → 모달에서 저장 목록 표시 (스크롤), 항목 클릭 시 해당 뇌파 데이터 적용.

### 6) 모바일 대응
- **viewport**: `width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover` 유지.
- **폰트**: `clamp(14px, 4vw, 20px)` 및 소형 화면에서 `clamp(15px, 4.5vw, 18px)` 적용.
- **가독성**: `-webkit-text-size-adjust: 100%`, 모바일에서 입력/버튼 `min-height: 44px`, `font-size: 16px` 권장 적용 (dashboard, index, login).

---

## 2. 오류 테스트 결과

### 2.1 코드·임포트
- **결과**: 통과.
- `db`, `user_storage`, `survey_storage`, `chat_storage`, `board_storage`, `eeg_storage` 임포트 정상.

### 2.2 SQL 파일 (create_tables_mysql.sql)
- **결과**: 문법 검사 통과 (괄호 균형, 5개 테이블 정의).
- **테이블**: users, survey_saves, chat_saves, board, eeg_saves.
- **권장**: 배포 전 MySQL에서 스크립트 실행 후 테이블 생성 여부 확인.

### 2.3 API 동작 (MySQL 미기동 환경)
- MySQL 미연결 시 `pymysql.err.OperationalError (2003)` 발생. 코드 경로 및 설정은 정상.
- MySQL 기동·DB 생성·테이블 생성 후에는 로그인, 회원, 설문/대화/게시판/뇌파 저장·목록·불러오기가 테이블 기반으로 동작하도록 구현됨.

### 2.4 관리자 메뉴
- **로그인 계정 탭**: 데모 + 등록 회원 목록 표시 (API `/api/admin/users`).
- **회원 관리 탭**: 등록 회원만 표시, 삭제 시 `/api/admin/users/delete` 호출.
- 관리자 계정: `admin@test.com` (세션 검증).

---

## 3. DB 데이터 저장 정상 여부 확인 방법

1. **로그인/회원**: 회원가입 후 로그인 → `users` 테이블에 행 추가. 관리자에서 회원 목록 노출.
2. **설문**: 설문 제출 후 "새로저장" → "정상 저장되었습니다." 확인 → `survey_saves`에 행 추가.
3. **대화**: AI 상담 후 "현재 대화 저장" → "정상 저장되었습니다." 확인 → `chat_saves`에 행 추가.
4. **게시판**: Step5에서 등록/수정 후 "정상 저장되었습니다." 확인 → `board`에 반영.
5. **뇌파**: Step3에서 불러오기 또는 입력 후 "저장" → "정상 저장되었습니다." 확인 → `eeg_saves`에 행 추가.

---

## 4. 파일 변경 목록

| 파일 | 변경 내용 |
|------|-----------|
| create_tables_mysql.sql | eeg_saves 테이블 추가 |
| main.py | 설문/대화 응답에 saved_ok, 뇌파 API /api/eeg-save, /api/eeg-saved-list, /api/eeg-saved/{id} 추가 |
| eeg_storage.py | 신규. 뇌파 저장·목록·한 건 조회 |
| static/dashboard.html | 설문 저장 메시지(정상 저장), 불러오기 목록 높이(65vh), 뇌파 저장/목록보기 버튼·모달·JS, 대화/게시판 저장 메시지, 모바일 스타일 |
| static/index.html | 모바일 폰트·viewport 조정 |
| static/login.html | 모바일 폰트·입력/버튼 높이 조정 |

---

## 5. 관리자 메뉴 기능 작동 상태

| 기능 | 상태 | 비고 |
|------|------|------|
| 로그인 계정 탭 | 정상 | 데모+가입 회원 목록 표시 |
| 회원 관리 탭 | 정상 | 가입 회원만 표시, 삭제 가능 |
| 관리자 인증 | 정상 | admin@test.com 세션 확인 |
| 로그아웃 | 정상 | /api/logout |

위와 같이 반영되었으며, MySQL 서버 기동 및 create_tables_mysql.sql 실행 후 전체 플로우를 한 번씩 확인하시면 됩니다.
