# 전체 프로그램 테스트 보고

**테스트 일시**: 2025년  
**환경**: Windows, SQLite (DB_ENGINE=sqlite)

---

## 1. 테스트 요약

| 테스트 | 결과 | 비고 |
|--------|------|------|
| test_db_save_load_edit_3run.py | **통과** (24/24) | DB 저장·조회·수정 3회, SQLite |
| test_db_demo_save_load.py | **통과** (16/16) | 회원/설문/대화/게시판/뇌파 저장·불러오기 |
| test_scoring.py | **통과** (5/5) | 설문 채점·필터·정규화 |
| test_combined_sbi.py | **통과** (7/7) | SBI 결합 지수·가중치·inconsistency |
| test_analysis_combined.py | **통과** (2/2) | 설문+뇌파 결합 분석 |
| test_knowledge_step3.py | **통과** | 지식 DB·블로그 수집·키워드 검색 |
| test_e2e_pipeline.py | **통과** (5/5) | E2E 파이프라인 5회, PDF 생성 |
| test_admin_dashboard_* | **미실행** | 서버 8001 기동 후 수동 실행 필요 |

---

## 2. 발견·수정한 오류

### 2.1 SQLite 사용 시 회원 가입 중복 이메일 오류

- **증상**: `test_db_save_load_edit_3run.py` 재실행 시 `UNIQUE constraint failed: users.email` 로 실패.
- **원인**: `user_storage.register()`가 MySQL의 `pymysql.IntegrityError`만 처리하고, SQLite의 `sqlite3.IntegrityError`는 처리하지 않음.
- **수정**: `user_storage.py`에서 `(pymysql.IntegrityError, sqlite3.IntegrityError)` 모두 잡아 `ValueError("이미 등록된 이메일입니다.")` 로 변환. 추가로 예외 메시지에 "UNIQUE constraint" / "Duplicate entry" 포함 시 동일 처리.

### 2.2 test_db_demo_save_load.py SQLite 미지원

- **증상**: SQLite 사용 시 `SHOW TABLES` 문법 오류.
- **수정**: `DB_ENGINE == "sqlite"` 일 때 `sqlite_master` 로 테이블 목록 조회하도록 분기 추가.

---

## 3. 테스트별 상세

### DB 저장·조회·수정 (test_db_save_load_edit_3run.py)

- 3회 반복: 회원 가입·조회, 설문 저장·목록·조회·수정·재조회, 대화 저장·목록·조회, 게시판 등록·목록·조회·수정·재조회, 뇌파 저장·목록·조회.
- **결과**: 24 항목 모두 성공.

### DB 데모 (test_db_demo_save_load.py)

- DB 연결·테이블 확인, 회원 가입·조회·비밀번호 확인, 설문/대화/게시판/뇌파 저장·목록·조회.
- **결과**: 16 항목 모두 성공.

### 스코어 (test_scoring.py)

- 데이터 로드, 전체/부분 설문 채점, 제외 순번, get_filtered_score.
- **결과**: 5 tests, OK.

### SBI 결합 (test_combined_sbi.py)

- 1~5점 → 0~100 정규화, 영역 가중치, Mock EEG, inconsistency_flag 20% 기준.
- **결과**: 7 tests, OK.

### 결합 분석 (test_analysis_combined.py)

- 설문만, 설문+뇌파(engagement) 시나리오.
- **결과**: 2 tests, OK.

### 지식 DB (test_knowledge_step3.py)

- SQLite 지식 DB 초기화, 블로그 1건 수집, 유튜브 자막 1건(스킵 가능), 키워드 검색.
- **결과**: OK.

### E2E 파이프라인 (test_e2e_pipeline.py)

- 설문 → 채점 → SBI → DB 검색 → PDF 생성 5회 반복.
- **결과**: 5회 모두 성공, E2E_PIPELINE_REPORT.md 생성.

---

## 4. 수동 확인 권장 항목

- **관리자 대시보드 연동**: 서버를 `python main.py` 로 기동한 뒤(포트 8000 또는 8001) `test_admin_dashboard_integration.py`, `test_admin_dashboard_연동.py` 실행.
- **웹 화면**: 로그인 → 대시보드 → Step 1~5, 저장·불러오기, 게시판, 관리자 메뉴 동작 확인.
- **닷홈 배포**: `db_config.json` 에 `engine: sqlite`, `database: sbi.db` 설정 후 `https://leejee5.dothome.co.kr/api/health/db` 에서 `{"db":"ok"}` 확인.

---

## 5. 결론

- **자동 테스트**: DB(저장·조회·수정), 스코어, SBI 결합, 결합 분석, 지식 DB, E2E 파이프라인 모두 **통과**.
- **수정 사항**: SQLite 사용 시 회원 중복 가입 예외 처리(`user_storage.py`), 데모 테스트의 SQLite 테이블 확인(`test_db_demo_save_load.py`) 반영 완료.
- **전체 프로그램**: 현재 기준으로 오류 없이 동작하는 것으로 확인됨.
