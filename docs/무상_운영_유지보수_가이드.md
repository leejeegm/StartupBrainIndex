# 무상 운영·유지보수 가이드 (가용성·안전성 확보)

무료 플랜으로 장기 운영할 때 **유연성**과 **안전성**을 유지하기 위한 설정·점검 사항입니다.

---

## 1. 데이터 안전성 (가용성)

### 1-1. DB는 반드시 외부(PostgreSQL) 권장

- **DB_ENGINE=postgres** + **DATABASE_URL** 사용 시:
  - 재배포·재시작해도 **회원·프로필·설문·상담·뇌파·게시판** 데이터가 유지됩니다.
- **DB_ENGINE=sqlite** 사용 시:
  - 재배포 시 디스크가 비워져 데이터가 사라지므로, **배포 전 백업** → **배포 후 복원**을 수동으로 반복해야 합니다.

→ 무상 운영 시 부담을 줄이려면 **처음부터 PostgreSQL 연결**을 권장합니다.  
설정 방법: [데이터_지속_가이드.md](./데이터_지속_가이드.md), [배포_전_체크리스트.md](./배포_전_체크리스트.md) 참고.

### 1-2. 백업 습관 (SQLite 사용 시)

- 관리자 메뉴 **배포 전 데이터 백업**으로 `.db` 파일을 주기적으로 다운로드해 보관합니다.
- 재배포 후에는 **기존 데이터 불러오기**로 복원할 수 있습니다.

---

## 2. 보안 (무상 운영 시 최소 수준)

### 2-1. 환경 변수로만 비밀 정보 관리

- **절대 코드·저장소에 넣지 않는 것**: 비밀번호, API 키, DB URL
- **반드시 환경 변수(또는 Render Environment)**로만 설정:
  - `SESSION_SECRET`: 세션 암호화
  - `DATABASE_URL`: PostgreSQL 연결 (postgres 사용 시)
  - `OPENAI_API_KEY`: AI 상담 (사용 시)
  - MySQL 사용 시: `DB_HOST`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`

`.env`는 `.gitignore`에 포함되어 있어 저장소에 올라가지 않도록 되어 있습니다.

### 2-2. 세션 보안

- 배포 환경에서는 **SESSION_SECRET**을 반드시 설정합니다.
- 미설정 시 앱 재시작마다 새 키가 생성되어, 재시작 후 모든 사용자 세션이 풀립니다.

### 2-3. 관리자·API 접근

- 관리자 전용 API(회원 목록, 테이블 조회·삭제·수정, 백업·복원·엑셀 내보내기)는 **로그인 + 관리자 이메일(admin@test.com)** 여부로 제한됩니다.
- 데모 관리자 비밀번호는 배포 시 다른 값으로 바꾸거나, 실제 회원 가입 후 DB에서 관리자 권한을 부여하는 방식으로 전환하는 것을 권장합니다.

### 2-4. 비밀번호·개인정보

- 회원 비밀번호는 **해시 후 저장**되며, API·엑셀 내보내기에서 비밀번호는 노출되지 않습니다.

---

## 3. 유연성 (변경·복구 용이)

### 3-1. DB 엔진 전환

- **sqlite ↔ postgres** 전환 시:
  - **sqlite → postgres**: Render PostgreSQL 추가 후 `DB_ENGINE=postgres`, `DATABASE_URL` 설정. 기존 데이터는 관리자 **엑셀 내보내기** 등으로 보관 후, 필요 시 수동 이전 또는 백업 복원 스크립트로 이전 가능.
  - **postgres → sqlite**: 일반적으로 비권장(데이터 유실 위험). 꼭 필요 시 DB 덤프 후 스크립트로 SQLite에 넣는 방식만 권장.

### 3-2. 설정 우선순위

- DB·세션 등 설정은 **환경 변수 > db_config.json > 기본값** 순으로 적용됩니다.
- 배포 환경에서는 **Environment Variables**만으로 제어하면 되므로, 코드 수정 없이 설정 변경이 가능합니다.

### 3-3. 오류 시 복구

- **로그인·가입 오류**: [데이터_지속_가이드.md](./데이터_지속_가이드.md) 및 [배포_전_체크리스트.md](./배포_전_체크리스트.md)대로 `DB_ENGINE`, `DATABASE_URL`, `SESSION_SECRET` 확인.
- **데이터 초기화됨**: SQLite 사용 중이었다면 이전에 받아 둔 `.db` 백업으로 **기존 데이터 불러오기** 복원. Postgres 사용 중이면 재배포만으로 데이터 유지.

---

## 4. 점검 주기 (무상 유지보수)

| 주기 | 점검 항목 |
|------|-----------|
| 배포 전 | [배포_전_체크리스트.md](./배포_전_체크리스트.md) 1~4단계 확인 |
| 배포 후 | 로그인·가입·저장·관리자 메뉴 1회 동작 확인 |
| 주 1회(권장) | SQLite 사용 시 관리자 **배포 전 데이터 백업**으로 `.db` 다운로드 |
| 설정 변경 시 | 환경 변수만 수정하고 재배포로 반영, 비밀/키는 코드에 넣지 않기 |

---

## 5. 요약

- **데이터 지속**: `DB_ENGINE=postgres` + `DATABASE_URL` 사용으로 재배포 시에도 데이터 유지.
- **보안**: 비밀·키·DB URL은 환경 변수만 사용, SESSION_SECRET 설정, 관리자 API는 관리자만 접근.
- **유연성**: 환경 변수로 설정 제어, 백업·복원·엑셀 내보내기로 복구 용이.
- **무상 운영**: 배포 전 체크리스트와 본 가이드를 따라 주기적으로 점검하면 가용성·안전성을 유지할 수 있습니다.
