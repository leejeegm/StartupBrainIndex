# 회원·프로필·저장 데이터 지속 가이드 (재배포 시 초기화 방지)

## 문제

- **Render 무료 플랜** 등에서는 재배포·재시작 시 **디스크가 초기화**됩니다.
- `DB_ENGINE=sqlite`로 두면 **회원 정보, 프로필, 설문·상담·뇌파 저장 데이터**가 매번 사라집니다.

## 근본 해결: 외부 DB 사용 (PostgreSQL 권장)

데이터를 **앱 서버와 분리된 DB**에 두면 재배포와 관계없이 **항상 유지**됩니다.

### 1) Render PostgreSQL (가장 간단)

1. **Render 대시보드** → **New +** → **PostgreSQL**
2. 이름·리전 선택 후 **Create PostgreSQL**
3. 생성된 DB의 **Internal Database URL** 복사 (또는 **External** URL; 내부 연결이 더 빠름)
4. **Web Service**(SBI 앱) → **Environment** → **Add Environment Variable**
   - Key: `DB_ENGINE` → Value: `postgres`
   - Key: `DATABASE_URL` → Value: (방금 복사한 URL 붙여넣기)
   - (Render가 같은 계정에서 PostgreSQL을 만들면 Web Service에 **연결(Link)** 해 주면 `DATABASE_URL`이 자동으로 들어갈 수 있음)
5. **Save** 후 재배포(또는 자동 배포)

이후 재배포를 해도 **회원·프로필·설문·상담·뇌파·게시판** 데이터는 PostgreSQL에 남습니다.

### 2) Supabase (무료 PostgreSQL)

1. [Supabase](https://supabase.com) 가입 후 프로젝트 생성
2. **Settings** → **Database** → **Connection string** (URI) 복사
3. Render Web Service **Environment**에 추가:
   - `DB_ENGINE=postgres`
   - `DATABASE_URL=postgresql://postgres.[ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres`
   - (비밀번호는 Supabase에서 확인)

### 3) MySQL (닷홈 등 기존 DB)

- 이미 외부 MySQL이 있으면 `DB_ENGINE=mysql`과 `DB_HOST`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`만 설정하면 됩니다.
- 재배포해도 DB 서버는 그대로이므로 데이터 유지됩니다.

---

## SQLite를 쓸 때 (임시 방안)

- **배포 전**: 관리자 → **배포 전 데이터 백업**으로 `.db` 파일 다운로드
- **재배포 후**: 관리자 → **기존 데이터 불러오기**에서 해당 파일 업로드 (전체 복원 또는 테이블 선택 복원)

이 방법은 **매번 수동**이므로, 장기적으로는 **PostgreSQL(또는 MySQL) 전환**을 권장합니다.

---

## 요약

| 방식 | 재배포 시 데이터 | 비고 |
|------|------------------|------|
| **DB_ENGINE=postgres** + Render PostgreSQL / Supabase | ✅ 유지 | 권장 |
| **DB_ENGINE=mysql** + 외부 MySQL | ✅ 유지 | 기존 DB 있을 때 |
| **DB_ENGINE=sqlite** | ❌ 초기화 | 수동 백업·복원 필요 |

로그인·회원가입·프로필·저장 데이터의 **지속 가능**을 위해 **DB_ENGINE=postgres**와 **DATABASE_URL** 설정을 권장합니다.

---

## 관련 문서

- **[배포_전_체크리스트.md](./배포_전_체크리스트.md)** — Render 무료 계정 기준 단계별 배포·DB 연결 절차
- **[무상_운영_유지보수_가이드.md](./무상_운영_유지보수_가이드.md)** — 무상 운영 시 가용성·안전성·유연성 확보
