# SBI 배포 준비 완료 체크리스트

최종 점검(완성도·데이터품질·유지보수·보안·시각요소) 반영 후 배포 전 확인용 문서입니다.

---

## 1. 보안

| 항목 | 확인 |
|------|------|
| `SESSION_SECRET` 환경변수 설정 (배포 시 필수 권장) | □ |
| 관리자 비밀번호: 데모 계정 `admin@test.com` / `sunkim5AD@#`. 운영 시 DB/환경변수 기반 인증 전환 권장 | □ |
| 모든 관리자 API `_admin_only(request)` 적용 | □ |
| SQL 파라미터 바인딩(%s, ?) 사용, 테이블명 화이트리스트(`ALLOWED_ADMIN_TABLES`) | □ |
| 응답 헤더: `X-Content-Type-Options`, `X-Frame-Options`, `Referrer-Policy` | □ |
| DB/PDF 등 오류 시 내부 경로·스택트레이스 노출 없음 (사용자 안내 문구만) | □ |

---

## 2. 데이터 품질·에러 처리

| 항목 | 확인 |
|------|------|
| DB 연결 실패: 사용자 안내 문구로 통일 (`_db_error_message`) | □ |
| 중복/제약 위반: "데이터 저장 시 중복 또는 제약 조건…" 안내 | □ |
| 기타 DB 오류: "일시적인 오류가 발생했습니다…" (내부 메시지 미노출) | □ |
| PDF 생성 실패: 경로/트레이스 포함 메시지 시 통일된 안내 문구로 대체 | □ |

---

## 3. PDF·시각 요소

| 항목 | 확인 |
|------|------|
| 역량 점수 없을 때 막대 그래프 생략, 대체 문구 출력 | □ |
| 뇌교육 5단계·BOS 5법칙: 문자열이 아닌 값 방어 처리 | □ |
| 추천 콘텐츠 URL: `url`/`링크` 키 모두 처리, 빈 URL 시 링크 문구 생략 | □ |
| AI 해석 요약: `str()` 처리 및 길이 제한(2000자) | □ |

---

## 4. 배포 환경 (예: Render)

| 단계 | 내용 |
|------|------|
| 1 | **Build**: `pip install -r requirements.txt` (필요 시 `runtime.txt`로 Python 버전 지정) |
| 2 | **Start**: `uvicorn main:app --host 0.0.0.0 --port $PORT` |
| 3 | **환경변수**: `DB_ENGINE`, `DATABASE_URL`(postgres 시), `SESSION_SECRET`, (선택) `OPENAI_API_KEY` |
| 4 | **DB**: `DB_ENGINE=postgres` + `DATABASE_URL` 권장 (재배포 시 데이터 유지) |

---

## 5. 배포 후 확인

| 순서 | 확인 항목 |
|------|-----------|
| 1 | 로그인 (데모/가입 계정), 회원가입, 이메일 중복·오류 메시지 ("Not found" 미표시) |
| 2 | 설문 저장·불러오기, PDF 생성·다운로드 |
| 3 | 관리자 로그인 → 대시보드, 테이블 목록·삭제·수정, 백업/복원/엑셀 내보내기 |
| 4 | 재배포 1회 후 동일 계정·데이터 유지 (postgres 사용 시) |

---

## 6. 참고 문서

- **배포 단계**: `docs/배포_전_체크리스트.md`
- **데이터 유지**: `docs/데이터_지속_가이드.md`
- **환경변수 예시**: `.env.example`
- **3회 점검 요약**: `docs/배포_전_최종_점검_보고.md`

위 항목을 확인한 뒤 배포하면 됩니다.
