# [무료 사용자용] DB 연결 설정 방법 (db_config.json 만들기)

환경 변수 대신, **DB 접속 정보만 담은 전용 파일**을 하나 만들어서 앱이 그 파일을 읽어 쓰는 방식입니다. (PHP의 `db_conn.php`와 같은 역할을 Python에서는 `db_config.json`으로 합니다.)

---

## 1단계: 설정 파일 만들기 (db_config.json)

1. **웹 FTP**에 접속합니다. (**html** 또는 프로젝트 루트 폴더 진입 — `main.py`, `db.py`가 있는 곳)
2. 상단의 **[새파일]** 버튼을 누릅니다.
3. 파일 이름을 **`db_config.json`** (또는 `db_config.php`가 아닌 **json** 확장자)로 입력하고 생성합니다.
4. 편집 창에 아래 내용을 복사해서 넣고, **본인의 정보로 수정**합니다.

```json
{
  "host": "localhost",
  "user": "아이디",
  "password": "비밀번호",
  "database": "아이디"
}
```

**수정할 곳**: `user`, `password`, `database` 값을 본인의 닷홈 정보로 변경합니다.

- **host**: 닷홈은 99% **localhost** 입니다.
- **user**: 닷홈 FTP 아이디
- **password**: 닷홈 FTP/DB 비밀번호
- **database**: 닷홈 FTP 아이디 (DB명과 보통 같음)

수정 후 **[저장]** 하세요.

---

## 2단계: 앱에서 사용하는 방식

- 이 프로젝트의 **`db.py`**는 앱 시작 시 **환경변수(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME)**를 먼저 확인합니다.
- 환경변수가 없거나 비어 있으면 **같은 폴더의 `db_config.json`**을 자동으로 읽습니다.
- 따라서 **db_config.json만 만들어 두면** 별도 설정 없이 DB 연결에 사용됩니다. (다른 페이지에서 include 할 필요 없음 — 서버가 시작될 때 한 번만 읽음)

---

## 왜 이 방법을 쓰나요? (무료 호스팅의 현실)

- **SetEnv 미작동 해결**: 닷홈 무료 서버는 자원 효율 때문에 `.htaccess`의 환경 변수를 무시하는 경우가 많습니다. 위 방법은 **설정 파일을 직접 읽는 방식**이라 서버에서 100% 동작합니다.
- **유지보수 용이**: 비밀번호를 바꾸면 **db_config.json 파일 하나만** 수정하면 됩니다.

---

## 보안 팁 (중요)

이 방식은 비밀번호가 파일 안에 적혀 있습니다. 해킹 시 소스가 노출되면 비밀번호도 노출될 수 있습니다. 무료 호스팅에서 완벽히 막기는 어렵지만, 최소한 다음을 지키세요.

- **저장소(git)에 올리지 마세요.**  
  이미 `.gitignore`에 `db_config.json`이 포함되어 있어, 커밋 시 제외됩니다.
- **웹 FTP에서 권한 설정**:  
  `db_config.json` 파일을 선택하고 **[권한 설정(chmod)]** 메뉴가 있다면, 권한을 **600**(나만 읽고 쓰기) 또는 **644**(기본값)로 두세요. **777로 설정하면 절대 안 됩니다.**

---

## MySQL이 안 될 때: SQLite 사용 (닷홈 등)

닷홈에서 MySQL 연결이 되지 않거나 `/api/health/db`가 계속 실패할 때는 **SQLite**로 전환하면 됩니다. SQLite는 별도 DB 서버 없이 **파일 하나(.db)**로 동작합니다.

1. **db_config.json**을 아래처럼만 수정합니다.

```json
{
  "engine": "sqlite",
  "database": "sbi.db"
}
```

2. **저장** 후 서버를 다시 실행하면, 프로젝트 폴더에 **sbi.db** 파일이 자동으로 생성되고 모든 회원/설문/대화/게시판/뇌파 데이터가 이 파일에 저장됩니다.
3. **https://leejee5.dothome.co.kr/api/health/db** 에 접속하면 `{"db": "ok", "message": "DB 연결 성공"}` 이 나와야 합니다.

- **engine**: `"mysql"`(기본) 또는 `"sqlite"`
- **database** (SQLite일 때): 파일 이름(예: `sbi.db`). 경로를 지정하지 않으면 프로젝트 루트에 생성됩니다.

---

## 연결 확인 (설정 후 테스트)

1. **db_config.json** 저장 후 서버(또는 로컬)에서 앱을 실행합니다.
2. 브라우저나 터미널에서 다음 주소로 접속합니다.  
   - 로컬: `http://localhost:8000/api/health/db`  
   - 닷홈: `https://본인도메인.dothome.co.kr/api/health/db`
3. **`{"db": "ok", "message": "DB 연결 성공"}`** 이 나오면 설정이 정상입니다.  
   `{"db": "error", "message": "..."}` 이 나오면 MySQL 설정을 확인하거나, 위처럼 **engine을 "sqlite"**로 바꿔 보세요.

---

## 정리

무료 사용자라면 `.htaccess`와 씨름하지 마시고, **db_config.json** 파일을 만들어 두는 방식으로 진행하시는 것을 추천합니다. 이 방법이 가장 스트레스 없이 한 번에 성공하는 길입니다.
